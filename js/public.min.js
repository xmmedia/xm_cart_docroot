var cart_public_app={models:{},views:{},collections:{}};Backbone.emulateHTTP=!0;Backbone.emulateJSON=!0;cart_public_app.models.order=Backbone.Model.extend({});cart_public_app.models.order_product=Backbone.Model.extend({url:"save_product",initialize:function(attributes){this.set("id",parseInt(attributes.id,0));this.set("cart_product_id",parseInt(attributes.cart_product_id,0));this.set("quantity",parseInt(attributes.quantity,0));this.set("unit_price",parseFloat(attributes.unit_price))}});cart_public_app.collections.order_products=Backbone.Collection.extend({model:cart_public_app.models.order_product,url:"load_products"});cart_public_app.views.add_product=Backbone.View.extend({events:{submit:"add_product"},add_product:function(e){e.preventDefault();var cart_product_id=parseInt(this.$el.find(".js_cart_product_id").val(),0),quantity=parseInt(this.$el.find(".js_cart_order_product_quantity").val(),0),existing=cart_public_app.router.order_products.findWhere({cart_product_id:cart_product_id});existing?existing.set("quantity",existing.get("quantity")+quantity):cart_public_app.router.order_products.add([{cart_product_id:cart_product_id,quantity:quantity}]);cart_public_app.router.order_products.forEach(function(model){model.save()})}});cart_public_app.views.cart=Backbone.View.extend({el:$(".js_cart"),template:Handlebars.compile("<ul></ul>"),initialize:function(){this.collection.on("change",this.render,this)},render:function(){var ul=$(this.template());this.collection.forEach(function(order_product){ul.append((new cart_public_app.views.cart_product({model:order_product})).render().el)});this.$el.append(ul);this.$(".js_loading").remove();return this}});cart_public_app.views.cart_product=Backbone.View.extend({tagName:"li",template:Handlebars.compile("{{name}} {{quantity}} x {{cost_formatted}}"),render:function(){this.$el.html(this.template(this.model.attributes));return this}});cart_public_app.router=new(Backbone.Router.extend({el:$(".js_cart"),routes:{"":"index",product_list:"product_list"},initialize:function(){this.order_products=new cart_public_app.collections.order_products;this.order_products.fetch({context:this,success:function(){cart_public_app.router.cart=(new cart_public_app.views.cart({collection:cart_public_app.router.order_products})).render()}})},start:function(){Backbone.history.start({pushState:!0,root:"/"+cart_config.prefix+"/"})},index:function(){},product_list:function(){_.each($(".js_cart_add_product"),function(el){new cart_public_app.views.add_product({el:el})})}}));$(function(){cart_public_app.router.start()});